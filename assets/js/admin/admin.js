(()=>{(function(){"use strict";document.addEventListener("DOMContentLoaded",l);let o,a,n,r;function l(){o=document.querySelectorAll(".digiblocks-block-card"),a=document.getElementById("digiblocks-save-blocks"),n=document.getElementById("digiblocks-settings-form"),r=document.querySelectorAll(".digiblocks-toggle-password"),o.length&&a&&d(),n&&g(),r.length&&h()}function d(){o.forEach(e=>{let i=e.querySelector('input[type="checkbox"]');i&&(i.addEventListener("change",function(){e.classList.toggle("is-active",this.checked)}),e.classList.toggle("is-active",i.checked))}),a.addEventListener("click",u)}function u(){let e=document.querySelector(".digiblocks-save-status"),i={};e.textContent=wp.i18n.__("Saving...","digiblocks"),e.classList.remove("success","error"),e.classList.add("visible"),o.forEach(t=>{let s=t.dataset.blockName,c=t.querySelector('input[type="checkbox"]');s&&c&&(i[s]=c.checked)}),fetch(digiBlocksAdmin.apiUrl+"update-blocks",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":digiBlocksAdmin.apiNonce},body:JSON.stringify(i)}).then(t=>t.json()).then(t=>{if(t.success)e.textContent=t.message,e.classList.add("success"),setTimeout(()=>{e.classList.remove("visible")},3e3);else throw new Error(t.message||"Error saving blocks settings")}).catch(t=>{e.textContent=t.message,e.classList.add("error")})}function g(){n.addEventListener("submit",function(e){e.preventDefault(),m()})}function m(){let e=document.querySelector(".digiblocks-save-status"),i=new FormData(n),t={};e.textContent=wp.i18n.__("Saving...","digiblocks"),e.classList.remove("success","error"),e.classList.add("visible");for(let[s,c]of i.entries())t[s]=c;fetch(digiBlocksAdmin.apiUrl+"update-settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":digiBlocksAdmin.apiNonce},body:JSON.stringify(t)}).then(s=>s.json()).then(s=>{if(s.success)e.textContent=s.message,e.classList.add("success"),setTimeout(()=>{e.classList.remove("visible")},3e3);else throw new Error(s.message||"Error saving settings")}).catch(s=>{e.textContent=s.message,e.classList.add("error")})}function h(){r.forEach(e=>{e.addEventListener("click",function(){let i=this.closest(".digiblocks-input-group");if(!i)return;let t=i.querySelector('input[type="password"], input[type="text"]');if(!t)return;let s=this.querySelector(".dashicons");t.getAttribute("type")==="password"?(t.setAttribute("type","text"),s.classList.remove("dashicons-visibility"),s.classList.add("dashicons-hidden")):(t.setAttribute("type","password"),s.classList.remove("dashicons-hidden"),s.classList.add("dashicons-visibility"))})})}})();})();
