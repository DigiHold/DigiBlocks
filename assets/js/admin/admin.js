(()=>{var A='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="rotate-icon" width="18" height="18"><path d="M94 187.1C120.8 124.1 183.3 80 256 80c39.7 0 77.8 15.8 105.9 43.9L414.1 176 360 176c-13.3 0-24 10.7-24 24s10.7 24 24 24l112 0c13.3 0 24-10.7 24-24l0-112c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 54.1L395.9 89.9C358.8 52.8 308.5 32 256 32C163.4 32 83.9 88.2 49.8 168.3c-5.2 12.2 .5 26.3 12.7 31.5s26.3-.5 31.5-12.7zm368 157c5.2-12.2-.4-26.3-12.6-31.5s-26.3 .4-31.5 12.6C391 388.1 328.6 432 256 432c-39.7 0-77.8-15.8-105.9-43.9L97.9 336l54.1 0c13.3 0 24-10.7 24-24s-10.7-24-24-24L40 288c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-54.1 52.1 52.1C153.2 459.2 203.5 480 256 480c92.5 0 171.8-56 206-135.9z"/></svg>';document.addEventListener("DOMContentLoaded",function(){let g=document.getElementById("digiblocks-settings-form"),r=document.querySelector(".digiblocks-save-status");g&&g.addEventListener("submit",function(n){n.preventDefault(),m()});function m(){let n=new FormData(g),e={};g.querySelectorAll("input, select, textarea").forEach(function(t){let s=t.name;s&&(t.type==="checkbox"?e[s]=t.checked:t.type!=="submit"&&t.type!=="button"&&(e[s]=t.value))}),r&&(r.innerHTML='<span class="digiblocks-saving">'+(digiBlocksAdmin.strings?.saving||"Saving...")+"</span>"),fetch(digiBlocksAdmin.apiUrl+"update-settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":digiBlocksAdmin.apiNonce},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{r&&(t.success?r.innerHTML='<span class="digiblocks-saved">'+(t.message||"Settings saved successfully!")+"</span>":r.innerHTML='<span class="digiblocks-error">'+(t.message||"Error saving settings.")+"</span>",setTimeout(function(){r.innerHTML=""},3e3))}).catch(t=>{r&&(r.innerHTML='<span class="digiblocks-error">'+(digiBlocksAdmin.strings?.networkError||"Network error occurred.")+"</span>",setTimeout(function(){r.innerHTML=""},3e3)),console.error("Settings save error:",t)})}let k=document.getElementById("newsletter_platform");k&&k.addEventListener("change",function(){document.querySelectorAll(".newsletter-platform-fields").forEach(function(i){i.style.display="none"});let e=this.value;if(e){let i=document.getElementById(e+"-fields");i&&(i.style.display="block")}});let L=document.getElementById("image_api_provider");L&&L.addEventListener("change",function(){document.querySelectorAll(".image-api-provider-fields").forEach(function(i){i.style.display="none"});let e=this.value;if(e){let i=document.getElementById(e+"-fields");i&&(i.style.display="block")}}),document.querySelectorAll(".digiblocks-toggle-password").forEach(function(n){n.addEventListener("click",function(){let e=this.parentElement.querySelector('input[type="password"], input[type="text"]'),i=this.querySelector(".dashicons");e.type==="password"?(e.type="text",i.classList.remove("dashicons-visibility"),i.classList.add("dashicons-hidden")):(e.type="password",i.classList.remove("dashicons-hidden"),i.classList.add("dashicons-visibility"))})});let u=document.getElementById("digiblocks-regenerate-assets"),b=document.getElementById("digiblocks-regenerate-progress"),y=document.querySelector(".digiblocks-progress-fill"),E=document.querySelector(".digiblocks-progress-text"),c=document.getElementById("digiblocks-regenerate-result");u&&u.addEventListener("click",function(){H()});function M(n,e,i){let t=`
			<div class="digiblocks-modal-overlay" id="digiblocks-confirm-modal">
				<div class="digiblocks-modal">
					<div class="digiblocks-modal-header">
						<h3 class="digiblocks-modal-title">Confirm Action</h3>
					</div>
					<div class="digiblocks-modal-body">
						<p class="digiblocks-modal-message">${n}</p>
					</div>
					<div class="digiblocks-modal-actions">
						<button type="button" class="digiblocks-modal-button is-secondary" id="digiblocks-modal-cancel">
							Cancel
						</button>
						<button type="button" class="digiblocks-modal-button is-primary" id="digiblocks-modal-confirm">
							Continue
						</button>
					</div>
				</div>
			</div>
		`;document.body.insertAdjacentHTML("beforeend",t);let s=document.getElementById("digiblocks-confirm-modal"),l=document.getElementById("digiblocks-modal-confirm"),o=document.getElementById("digiblocks-modal-cancel");setTimeout(()=>{s.classList.add("is-visible")},10),setTimeout(()=>{l.focus()},300),l.addEventListener("click",function(){B(s),typeof e=="function"&&e()}),o.addEventListener("click",function(){B(s),typeof i=="function"&&i()}),s.addEventListener("click",function(p){p.target===s&&(B(s),typeof i=="function"&&i())});let v=function(p){p.key==="Escape"&&(B(s),typeof i=="function"&&i(),document.removeEventListener("keydown",v))};document.addEventListener("keydown",v);function B(p){p.classList.remove("is-visible"),setTimeout(()=>{p.parentNode&&p.parentNode.removeChild(p)},300),document.removeEventListener("keydown",v)}}function H(){let n=digiBlocksAdmin.strings?.confirmRegenerate||"This will regenerate all DigiBlocks assets including builder elements. This may take a few moments. Continue?";M(n,function(){C()},function(){})}function C(){u.disabled=!0,u.innerHTML=A+(digiBlocksAdmin.strings?.regenerating||"Regenerating..."),b&&(b.style.display="block"),c&&(c.innerHTML="",c.className="digiblocks-regenerate-result"),y&&(y.style.width="0%"),E&&(E.textContent=digiBlocksAdmin.strings?.regenerating||"Regenerating assets...");let n=0,e=setInterval(function(){n+=1,n<=90&&y&&(y.style.width=n+"%")},100);fetch(digiBlocksAdmin.apiUrl+"regenerate-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":digiBlocksAdmin.apiNonce}}).then(i=>i.json()).then(i=>{clearInterval(e),y&&(y.style.width="100%"),setTimeout(function(){if(b&&(b.style.display="none"),u.disabled=!1,u.innerHTML=A+(digiBlocksAdmin.strings?.regenerateButton||"Regenerate All Assets"),c){if(i.success){if(c.className="digiblocks-regenerate-result active success",c.innerHTML=i.message,i.details){let t=i.details,s="<br><small>";t.posts>0&&(s+=(digiBlocksAdmin.strings?.postsProcessed||"Posts processed: ")+t.posts+"<br>"),t.builders>0&&(s+=(digiBlocksAdmin.strings?.buildersProcessed||"Builders processed: ")+t.builders+"<br>"),s+=(digiBlocksAdmin.strings?.cssFiles||"CSS files: ")+t.css_files+"<br>",s+=(digiBlocksAdmin.strings?.jsFiles||"JS files: ")+t.js_files+"<br>",s+=(digiBlocksAdmin.strings?.fontFiles||"Font files: ")+t.font_files,t.errors&&t.errors.length>0&&(s+="<br><strong>"+(digiBlocksAdmin.strings?.errors||"Errors:")+"</strong><br>",t.errors.forEach(function(l){s+="\u2022 "+l+"<br>"})),s+="</small>",c.innerHTML+=s}}else c.className="digiblocks-regenerate-result active error",c.innerHTML=i.message||digiBlocksAdmin.strings?.regenerateError||"An error occurred while regenerating assets.";setTimeout(function(){c&&(c.innerHTML="",c.className="digiblocks-regenerate-result")},15e3)}},500)}).catch(i=>{clearInterval(e),b&&(b.style.display="none"),u.disabled=!1,u.innerHTML=A+(digiBlocksAdmin.strings?.regenerateButton||"Regenerate All Assets"),c&&(c.className="digiblocks-regenerate-result active error",c.innerHTML=digiBlocksAdmin.strings?.networkError||"Network error occurred. Please try again.",setTimeout(function(){c.innerHTML="",c.className="digiblocks-regenerate-result"},1e4)),console.error("Regenerate assets error:",i)})}let T=document.getElementById("digiblocks-save-blocks"),d=document.querySelector(".digiblocks-admin-section .digiblocks-save-status");T&&T.addEventListener("click",function(){S()});let w=document.querySelectorAll('.digiblocks-block-toggle input[type="checkbox"]');w.length>0&&w.forEach(function(n){n.addEventListener("change",function(){let e=n.closest(".digiblocks-block-card");e&&(n.checked?e.classList.add("is-active"):e.classList.remove("is-active")),S()})});function S(){let n={};document.querySelectorAll('.digiblocks-block-card input[type="checkbox"]').forEach(function(i){let t=i.closest(".digiblocks-block-card");if(t){let s=t.getAttribute("data-block-name");s&&(n[s]=i.checked)}}),d&&(d.innerHTML='<span class="digiblocks-saving">'+(digiBlocksAdmin.strings?.saving||"Saving...")+"</span>"),fetch(digiBlocksAdmin.apiUrl+"update-blocks",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":digiBlocksAdmin.apiNonce},body:JSON.stringify(n)}).then(i=>i.json()).then(i=>{d&&(i.success?d.innerHTML='<span class="digiblocks-saved">'+(i.message||"Block settings saved successfully!")+"</span>":d.innerHTML='<span class="digiblocks-error">'+(i.message||"Error saving block settings.")+"</span>",setTimeout(function(){d.innerHTML=""},3e3))}).catch(i=>{d&&(d.innerHTML='<span class="digiblocks-error">'+(digiBlocksAdmin.strings?.networkError||"Network error occurred.")+"</span>",setTimeout(function(){d.innerHTML=""},3e3)),console.error("Block settings save error:",i)})}document.addEventListener("click",function(n){if(n.target.closest(".digiblocks-plugin-action")){n.preventDefault();let e=n.target.closest(".digiblocks-plugin-action"),i=e.dataset.action,t=e.dataset.type;if(e.dataset.url){window.open(e.dataset.url,"_blank");return}e.disabled=!0;let s=e.querySelector("span"),l=s.textContent;if(i==="install"){if(s.textContent=digiBlocksAdmin.strings.installing,t==="plugin"){let o=e.dataset.plugin;P(o,e,l)}else if(t==="theme"){let o=e.dataset.theme;_(o,e,l)}}else if(i==="activate"){if(s.textContent=digiBlocksAdmin.strings.activating,t==="plugin"){let o=e.dataset.plugin;x(o,e,l)}else if(t==="theme"){let o=e.dataset.theme;q(o,e,l)}}}});function P(n,e,i){let t=new FormData;t.append("action","digiblocks_install_plugin"),t.append("plugin",n),t.append("nonce",digiBlocksAdmin.nonce),fetch(digiBlocksAdmin.ajaxUrl,{method:"POST",body:t}).then(s=>s.json()).then(s=>{s.success?(a(s.data.message,"success"),h(e,s.data.status,n,"plugin")):(a(s.data||digiBlocksAdmin.strings.error,"error"),f(e,i))}).catch(s=>{console.error("Error:",s),a(digiBlocksAdmin.strings.error||"An error occurred. Please try again.","error"),f(e,i)})}function x(n,e,i){let t=new FormData;t.append("action","digiblocks_activate_plugin"),t.append("plugin",n),t.append("nonce",digiBlocksAdmin.nonce),fetch(digiBlocksAdmin.ajaxUrl,{method:"POST",body:t}).then(s=>s.json()).then(s=>{s.success?(a(s.data.message,"success"),h(e,s.data.status,n,"plugin")):(a(s.data||digiBlocksAdmin.strings.error,"error"),f(e,i))}).catch(s=>{console.error("Error:",s),a(digiBlocksAdmin.strings.error||"An error occurred. Please try again.","error"),f(e,i)})}function _(n,e,i){let t=new FormData;t.append("action","digiblocks_install_theme"),t.append("theme",n),t.append("nonce",digiBlocksAdmin.nonce),fetch(digiBlocksAdmin.ajaxUrl,{method:"POST",body:t}).then(s=>s.json()).then(s=>{s.success?(a(s.data.message,"success"),h(e,s.data.status,n,"theme")):(a(s.data||digiBlocksAdmin.strings.error,"error"),f(e,i))}).catch(s=>{console.error("Error:",s),a(digiBlocksAdmin.strings.error||"An error occurred. Please try again.","error"),f(e,i)})}function q(n,e,i){let t=new FormData;t.append("action","digiblocks_activate_theme"),t.append("theme",n),t.append("nonce",digiBlocksAdmin.nonce),fetch(digiBlocksAdmin.ajaxUrl,{method:"POST",body:t}).then(s=>s.json()).then(s=>{s.success?(a(s.data.message,"success"),h(e,s.data.status,n,"theme")):(a(s.data||digiBlocksAdmin.strings.error,"error"),f(e,i))}).catch(s=>{console.error("Error:",s),a(digiBlocksAdmin.strings.error||"An error occurred. Please try again.","error"),f(e,i)})}function h(n,e,i,t){n.disabled=!1,n.classList.remove("button-primary","button-secondary"),n.classList.add(e.button_class),n.querySelector("span").textContent=e.button_text,e.status==="active"?(n.dataset.action="learn_more",n.dataset.url=e.url):e.status==="inactive"?(n.dataset.action="activate",delete n.dataset.url):(n.dataset.action="install",delete n.dataset.url)}function f(n,e){n.disabled=!1,n.querySelector("span").textContent=e}function a(n,e){document.querySelectorAll(".digiblocks-notification").forEach(o=>o.remove());let s=`
			<div class="notice ${e==="success"?"notice-success":"notice-error"} is-dismissible digiblocks-notification" style="margin: 1rem 0;">
				<p>${n}</p>
				<button type="button" class="notice-dismiss">
					<span class="screen-reader-text">Dismiss this notice.</span>
				</button>
			</div>
		`,l=document.querySelector(".digiblocks-admin-content");if(l){l.insertAdjacentHTML("beforebegin",s);let o=l.previousElementSibling;o&&o.classList.contains("digiblocks-notification")&&(o.querySelector(".notice-dismiss").addEventListener("click",function(){N(o,300,function(){o.remove()})}),e==="success"&&setTimeout(function(){o&&o.parentNode&&N(o,300,function(){o.remove()})},5e3))}}function N(n,e,i){n.style.transition=`opacity ${e}ms`,n.style.opacity="0",setTimeout(function(){i&&i()},e)}});window.digiBlocksAdmin=window.digiBlocksAdmin||{};window.digiBlocksAdmin.showNotice=function(g,r="success"){let m=document.createElement("div");m.className=`notice notice-${r} is-dismissible digiblocks-notice`,m.innerHTML=`<p>${g}</p>`;let k=document.querySelector("#wpbody-content .wrap h1");k&&(k.parentNode.insertBefore(m,k.nextSibling),setTimeout(function(){m.parentNode&&m.parentNode.removeChild(m)},5e3))};window.digiBlocksAdmin.confirm=function(g,r){return confirm(g)?(typeof r=="function"&&r(),!0):!1};})();
